<?xml version="1.0"?>
<!--
/**
 * @author Amasty Team
 * @copyright Copyright (c) 2017 Amasty (https://www.amasty.com)
 * @package Amasty_CustomerAttributes
 */
-->
<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:framework:ObjectManager/etc/config.xsd">
    <preference for="Amasty\CustomerAttributes\Api\RelationRepositoryInterface" type="Amasty\CustomerAttributes\Model\RelationRepository"/>
    <preference for="Amasty\CustomerAttributes\Api\Data\RelationInterface" type="Amasty\CustomerAttributes\Model\Relation"/>
    <preference for="Amasty\CustomerAttributes\Api\Data\RelationDetailInterface" type="Amasty\CustomerAttributes\Model\RelationDetails"/>
    <preference for="selectimg" type="Magento\Framework\Data\Form\Element\Select"/>
    <preference for="multiselectimg" type="Magento\Framework\Data\Form\Element\Multiselect"/>

    <preference for="Magento\Customer\Model\Metadata\Form\File" type="Amasty\CustomerAttributes\Model\Customer\Metadata\Form\File"/>

    <type name="Magento\Framework\View\Element\UiComponent\DataProvider\CollectionFactory">
        <arguments>
            <argument name="collections" xsi:type="array">
                <item name="amcustomerattr_relation_grid_data_source" xsi:type="string">Amasty\CustomerAttributes\Model\ResourceModel\Relation\Grid\Collection</item>
            </argument>
        </arguments>
    </type>
    <type name="\Magento\Quote\Model\Quote\Address\CustomAttributeList">
        <plugin name="Amasty_CustomerAttributes::CustomAttributeList" type="Amasty\CustomerAttributes\Plugin\Quote\Address\CustomAttributeList" />
    </type>
    <type name="\Magento\Quote\Model\Quote">
        <plugin name="Amasty_CustomerAttributes::Quote" type="Amasty\CustomerAttributes\Plugin\Quote\Quote" />
    </type>
    <type name="Magento\Quote\Model\QuoteManagement">
        <plugin name="Amasty_CustomerAttributes::PlaceOrder" type="Amasty\CustomerAttributes\Plugin\Quote\QuoteManagement" />
    </type>
    <type name="Magento\Customer\Model\Metadata\Form">
        <plugin name="Amasty_CustomerAttributes::metadata-form" type="Amasty\CustomerAttributes\Plugin\Customer\Metadata\Form" />
    </type>
    <type name="Magento\Eav\Model\Validator\Attribute\Data">
        <plugin name="Amasty_CustomerAttributes::customer-arrtibute-validation" type="Amasty\CustomerAttributes\Plugin\Eav\Model\Validator\Data"/>
    </type>
    <type name="Magento\Framework\Webapi\ServiceInputProcessor">
        <plugin name="Amasty_CustomerAttributes::convert_multiple_values-to-array"
                type="Amasty\CustomerAttributes\Plugin\Webapi\ServiceInputProcessor"/>
    </type>


    <!-- product save plugin. SAve customer group if attribute with this type exist-->
    <type name="Magento\Customer\Api\CustomerRepositoryInterface">
        <plugin name="Amasty_CustomerAttributes::customer-group" type="Amasty\CustomerAttributes\Plugin\Customer\Api\CustomerRepositoryInterface" />
    </type>
    <type name="Magento\Rule\Model\Condition\AbstractCondition">
        <plugin name="Amasty_CustomerAttributes::add-condition-types" type="Amasty\CustomerAttributes\Plugin\Rule\Condition" />
    </type>
</config>
